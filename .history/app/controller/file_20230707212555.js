"use strict";constController=require("egg").Controller;constfs=require("fs");constpath=require("path");classFileControllerextendsController{// 上传asyncupload(){const{ctx,app,service}=this;constcurrentUser=ctx.authUser;console.log(ctx.request.files);if(!ctx.request.files){returnctx.apiFail("请先选择上传文件");}ctx.validate({file_id:{required:true,type:"int",defValue:0,desc:"目录id",},});constfile_id=ctx.query.file_id;console.log(file_id+"<<<<<<<<<<");// 目录id是否存在if(file_id>0){// 目录是否存在awaitservice.file.isDirExist(file_id);}//取得上传的文件constfile=ctx.request.files[0];// 根据file_id一直向上找到顶层目录constprefixPath=awaitservice.file.seachDir(file_id);console.log(prefixPath);// 拼接出最终文件上传目录constname=prefixPath+ctx.genID(10)+path.extname(file.filename);// 判断用户网盘内存是否不足lets=awaitnewPromise((resolve,reject)=>{
    fs.stat(file.filepath,(err,stats)=>{resolve((stats.size/1024).toFixed(1));});}
};